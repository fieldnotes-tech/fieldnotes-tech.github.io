<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Hugo Makefile | fieldnotes.tech</title>

    <style>body{margin:40px auto;max-width:650px;line-height:1.6;font-size:18px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}div.header h1{padding-top:0;padding-bottom:8px;margin-bottom:24px;font-size:18px;font-weight:400;border-bottom:1px solid}.header-menu{float:right}ul.pagination{list-style-type:none;text-align:center;padding:0}ul.pagination>li{padding:0 8px;display:inline-block}div.footer{border-top:1px solid;text-align:center}img{max-width:100%;max-height:100%;display:block;margin-left:auto;margin-right:auto}</style>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-135580398-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


    
</head>

<body>
<div class="header">
    <h1>
        <a href="/">fieldnotes.tech</a>
        <div class="header-menu">
        </div>
    </h1>
</div>
<div id="content">

<header>
    <h1>Hugo Makefile</h1>
    

<div class="post-meta">
    Date &#x5b;
    <time datetime="2019-03-03">Mar 3, 2019</time>
    &#x5d;
    Tags &#x5b;
    <a href="https://fieldnotes.tech/tags/hugo/">hugo</a>
    <a href="https://fieldnotes.tech/tags/make/">make</a>
    <a href="https://fieldnotes.tech/tags/meta/">meta</a>
    &#x5d;
</div>
</header>
<article>
    <p>This blog is hosted on <a href="https://pages.github.com">GitHub Pages</a>
and published using <a href="https://gohugo.io">Hugo</a>.
Since Go is my preferred language at the moment, Hugo seemed attractive.</p>

<p>There are 2 Git repos for this website:</p>

<ul>
<li>Source code:
<a href="https://github.com/fieldnotes-tech/fieldnotes.tech">github.com/fieldnotes-tech/fieldnotes.tech</a></li>
<li>Rendered static site:
<a href="https://github.com/fieldnotes-tech/fieldnotes-tech.github.io">github.com/fieldnotes-tech/fieldnotes-tech.github.io</a></li>
</ul>

<p>Publishing involves updating the source,
and having Hugo generate the static site.
To make this easier to use I&rsquo;ve added a <code>Makefile</code>
which pulls the rendered site as a submodule
in the <code>public/</code> directory,
which is Hugo&rsquo;s default place to write the rendered site.
It also pulls the <a href="https://github.com/ribice/kiss">kiss theme</a>&rsquo;s submodule,
and ensures it&rsquo;s set to a specific revision.
(I don&rsquo;t want to be surprised if this gets broken in some way later.)</p>

<p>This Makefile works fine on my dev machine,
but will need some refinement for the next phase:
having the site regenerated in CI on every push.
Some issues that will need to be solved are:</p>

<ul>
<li>It presumes the <code>hugo</code> command is already installed,</li>
<li>It does not assert which version of Hugo should be used.</li>
</ul>

<p>Here is the Makefile as it stands right now&hellip;</p>

<pre><code class="language-Makefile">SHELL := /usr/bin/env bash
HUGO := hugo
DATE := $(shell date)
DOMAIN := fieldnotes.tech
KISS_THEME_REVISION := 55f6f0068e8304bf7ac848e68f918912bd8d5336

.PHONY: publish commit public kiss-theme submodules clean-workspace

publish: commit
	cd public &amp;&amp; git push origin master

commit: public
	cd public &amp;&amp; \
	if git diff --exit-code; then \
		echo &quot;Nothing to commit.&quot;; \
	else \
		git add -A &amp;&amp; git commit -m &quot;publish: $(DATE)&quot;; \
	fi

public: clean-workspace submodules kiss-theme
	rm -rf $@/*
	echo $(DOMAIN) &gt; $@/CNAME
	$(HUGO)

kiss-theme: submodules
	cd themes/kiss &amp;&amp; git reset --hard $(KISS_THEME_REVISION)

submodules:
	git submodule update --recursive --remote

clean-workspace:
	@if [ ! -z &quot;$$(git status -s)&quot; ]; then echo &quot;[ERR] Workspace dirty.&quot;; exit 1; fi
</code></pre>

<p>Next up: getting this website built in CI on every push&hellip;</p>

</article>


    </div>
<div class="footer">
    
    

    
    
    <div class="copyright">&amp;copy; Sam Salisbury 2019</div>
    
</div>
</body>

</html>